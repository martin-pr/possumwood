# Basic parameters of the build
sudo: required
dist: xenial
group: edge
language: cpp
compiler: gcc

# Blacklist - make sure we don't try to build gh-pages branch
branches:
  except:
    - gh-pages

# Environment variables
env:
  global:
    - GH_REPO_NAME: possumwood
    - DOXYFILE: $TRAVIS_BUILD_DIR/Doxyfile
    - GH_REPO_REF: github.com/martin-pr/possumwood.git
    - COMPILER: g++-5

# Install dependencies
addons:
  apt:
    sources:
      - ubuntu-toolchain-r-test
    packages:
      - libboost-all-dev
      - doxygen
      - doxygen-doc
      - doxygen-latex
      - doxygen-gui
      - graphviz
      - gcc-5
      - g++-5
      - freeglut3-dev
      - libxmu-dev
      - libxi-dev
      - cmake
      - libglew-dev
      - libmpfr-dev
      - libglfw3-dev
      - qt5-default
      - qtdeclarative5-dev
      - libqt5opengl5-dev
      - libopenimageio-dev
      - libluabind-dev

# Run build
script:
  - wget http://www.mprazak.info/cgal-releases-CGAL-4.11.tar.gz
  - tar xzf cgal-releases-CGAL-4.11.tar.gz
  - pushd cgal-releases-CGAL-4.11 && mkdir build && pushd build && cmake .. -DCMAKE_INSTALL_PREFIX:PATH=/usr -DWITH_examples=OFF -DWITH_demos=OFF -DWITH_tests=OFF && make && sudo make install && popd && popd

  - export CXX=g++-5
  - export CC=gcc-5
  - cd $TRAVIS_BUILD_DIR
  - ./tools/build-debug -j 4
  - ./tools/run-tests

# Upload code to launchpad
deploy:
  provider: launchpad
  slug: "~martin-prazak/possumwood/+git/trunk"
  oauth_token:
    secure: GkKpIFYbLHXElFhPV9zLNVpM7vcnWXNGlquTJ2MC1Wx0wZnDl1thDi3ebTY+sIIDXMcjh1a3b1BzioOp/9J59LT4DKnm4UrMi65n0jwDnSKFrXQq3cYaa1n5oepfj5m9HdGsHWKBthLYC3Ii0ZE+j8oYfBCsYyDGpc1c+AW3aVuY6y4jqRuRegh274HST/osIlRa0xi5nOb0fkf/f2P9qSAYKoW2ap0olJxz3i60N+omA5lMggZzICDb7kBe/KcE7KIQHT4jNNUut2XWueNKsrr211jmIBa2ZuaRd3nxnGUrBRQy30T4LqfZk819yih54GTGfQ+MzQTeyOVD+azVtT+reb1S6e9+DgSD8UqpAP7/Hb7lGdVJ9b+A8HPICymxlLtlClNp0Bi5TBa0h0mDqKcAerGli2ATW2CSNYV9V9RrwUgXUy+5Z8irUE98tf1i4B9X6a64LKfKR7UM813h2nRDaMbSaEudbJLPR17LGmgo9xeT9yLCBF9jsHW1iEilU96fDyWSt7tJW1tPJxmVAKKYE2GaNKCbWIv8YdjGU/aYl07ljsN+qYPI4F1XiQ62Xnbjrhc3eOMMDvfk/LzsQaXIfhxlNKlsXsIto8QMmz5MUk+hkdrp3iY7LUI54lEiAimX/UaWwox2zk1HWOY8LAORkF7EeIGJyNqolos8n6Q=
  oauth_token_secret:
    secure: WBByBthsXQeMtgC/V9KfKTihTXeX2NzpDbQmk2hS8V/x0lEP37vsJGCJQgQO+HVTcbsULPZpO70IQ7nMhdTfLIB76M+oLNpACHToUC6pVEn8b8NKijAFpSNwz9IgYJgdtu6to7qiMhSwZjuWRUkDdCmSe1irfP8ZSw5OkZAeI6BSfGSOvEvKSVGKt0Ib38EKz/RW57MfBiHg0P7ykK9l9vHjGRalolv9Ix5fnrkt0knDoGaJMgH4bLW7mOXVrVitFBWtwFDhOZT1k+ASdO2TX8RhdBsjcIUQSzRaFB4hZmhVzDj6NDEtrxa7T6qQkCVsS3EbZxvf9coq2oktkUwXYeKIbZisk0yySPm38eVAT+MGoArg/IS3kdbpTa4jSfTl4UCzGSOIQRxIYSVRkGN0ypZdhvBgxTIWLUVyj6Q7fI/0Uf+0/iJre+5MHzjaGrn1wYPpmogUW4Tv4cV0Vhin0e/PDe52nU1h2TFh8AsU1uEcmBPV+436nCPRem/g1DLtY11tMWmAgkvKQU6DshdCH6CbgD/XDK42Up8gypJNno8RoHT67j+U91nui7+az4gISqKawI2VRSygtKgAXG4LDwdON85plhoGxmS9UGBgzjE8RXu5f70Vu4uByAwZ6RO8G9dSh/qc/WezemfJimKVaESzuddUFpsufmHUaLiEWBU=

# Generate and deploy documentation
after_success:
  - cd $TRAVIS_BUILD_DIR
  - ./tools/build-docs
